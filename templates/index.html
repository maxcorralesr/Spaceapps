<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - AuraTempo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
        }
        h1 {
            color: #005a9c;
            text-align: center;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="tel"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .btn {
            flex-grow: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn.secondary {
            background-color: #6c757d;
        }
        .btn.secondary:hover {
            background-color: #5a6268;
        }
        .hidden {
            display: none;
        }
        #welcome-message {
            text-align: center;
            color: #28a745;
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="user-type-selection">
        <div class="form-group">
            <label>¿Qué tipo de uso le darás a la página?</label>
            <div class="btn-group">
                <button class="btn" onclick="showForm('personal')">Uso Personal</button>
                <button class="btn secondary" onclick="showForm('institucional')">Uso Institucional</button>
            </div>
        </div>
    </div>

    <form id="personal-form" class="hidden" onsubmit="return createPersonalAccount()">
        <h2>Registro Personal</h2>
        <div class="form-group">
            <label for="p-nombre">Nombre:</label>
            <input type="text" id="p-nombre" required>
        </div>
        <div class="form-group">
            <label for="p-email">Correo Electrónico:</label>
            <input type="email" id="p-email" required>
        </div>
        <div class="form-group">
            <label for="p-password">Contraseña:</label>
            <input type="password" id="p-password" required>
        </div>
        <div class="form-group">
            <label for="p-edad">Edad:</label>
            <input type="number" id="p-edad" required>
        </div>
        <div class="form-group">
            <label for="p-region">Región:</label>
            <select id="p-region" required>
                <option value="" disabled selected>Selecciona tu región</option>
                <option value="norteamerica">Norteamérica</option>
                <option value="suramerica">Suramérica</option>
                <option value="europa">Europa</option>
                <option value="africa_norte">África Norte</option>
                <option value="africa_sur">África Sur</option>
                <option value="asia_este">Asia Este</option>
                <option value="asia_oeste">Asia Oeste</option>
                <option value="oceania">Oceanía</option>
            </select>
        </div>
        <div class="form-group">
            <label for="p-telefono">Teléfono:</label>
            <input type="tel" id="p-telefono" required>
        </div>
        <div class="form-group">
            <label for="p-sexo">Sexo:</label>
            <select id="p-sexo" required>
                <option value="" disabled selected>Selecciona una opción</option>
                <option value="hombre">Hombre</option>
                <option value="mujer">Mujer</option>
                <option value="otro">Otro</option>
                <option value="no_decir">Prefiero no decirlo</option>
            </select>
        </div>
        <div class="form-group">
            <label for="p-oficio">Oficio:</label>
            <select id="p-oficio" onchange="checkOther(this.value, 'p-otro-oficio-container')" required>
                <option value="" disabled selected>Selecciona tu oficio</option>
                <optgroup label="Salud y Cuidado">
                    <option value="admin_escuela">Administrador escolar</option>
                    <option value="gerente_geriatrico">Gerente de centro geriátrico</option>
                    <option value="entrenador_atletico">Entrenador/Director atlético</option>
                </optgroup>
                <optgroup label="Sector Público y Respuesta">
                    <option value="funcionario_gobierno">Funcionario gubernamental/Líder municipal</option>
                    <option value="autoridad_transporte">Autoridad de transporte</option>
                    <option value="depto_parques">Departamento de parques y recreación</option>
                    <option value="oficial_salud_ambiental">Oficial de salud ambiental (distrito escolar)</option>
                    <option value="gestion_incendios">Equipo de gestión de incendios forestales</option>
                    <option value="org_desastres">Organización de preparación para desastres</option>
                    <option value="servicio_meteorologico">Proveedor de servicios meteorológicos</option>
                    <option value="comunicacion_crisis">Especialista en comunicación de crisis</option>
                </optgroup>
                 <optgroup label="Otros Sectores">
                    <option value="residente_industrial">Residente en zona industrial</option>
                    <option value="turismo">Junta de turismo</option>
                    <option value="evaluador_riesgos">Evaluador de riesgos de seguros</option>
                    <option value="ciencia_ciudadana">Coordinador de ciencia ciudadana</option>
                    <option value="otro">Otro</option>
                 </optgroup>
            </select>
        </div>
        <div id="p-otro-oficio-container" class="form-group hidden">
            <label for="p-otro-oficio">Por favor, especifica tu oficio:</label>
            <input type="text" id="p-otro-oficio">
        </div>
        <div class="form-group">
            <label>¿Te consideras parte de un grupo vulnerable a la calidad del aire?</label>
            <input type="radio" id="vulnerable-si" name="vulnerable" value="si" onclick="showVulnerableOptions(true)">
            <label for="vulnerable-si" style="display: inline;">Sí</label>
            <input type="radio" id="vulnerable-no" name="vulnerable" value="no" onclick="showVulnerableOptions(false)" checked>
            <label for="vulnerable-no" style="display: inline;">No</label>
        </div>
        <div id="vulnerable-options" class="form-group hidden">
            <label for="vulnerable-group">¿A cuál perteneces?</label>
            <select id="vulnerable-group">
                <option value="" disabled selected>Selecciona un grupo</option>
                <option value="embarazada">Mujeres embarazadas</option>
                <option value="niños">Niños</option>
                <option value="cardiovascular">Personas con enfermedades cardiovasculares</option>
                <option value="respiratoria">Personas con enfermedades respiratorias</option>
                <option value="adulto_mayor">Adultos mayores</option>
                <option value="otro">Otro</option>
            </select>
        </div>
        <button type="submit" class="btn">Crear Cuenta</button>
    </form>

    <form id="institucional-form" class="hidden" onsubmit="return createInstitutionalAccount()">
        <h2>Registro Institucional</h2>
        <div class="form-group">
            <label for="i-nombre">Nombre de la institución:</label>
            <input type="text" id="i-nombre" required>
        </div>
        <div class="form-group">
            <label for="i-email">Correo Electrónico:</label>
            <input type="email" id="i-email" required>
        </div>
        <div class="form-group">
            <label for="i-password">Contraseña:</label>
            <input type="password" id="i-password" required>
        </div>
        <div class="form-group">
            <label for="i-telefono">Teléfono para Alertas:</label>
            <input type="tel" id="i-telefono" required>
        </div>
        <div class="form-group">
            <label for="i-region">Región:</label>
            <select id="i-region" required>
                <option value="" disabled selected>Selecciona una región</option>
                <option value="norteamerica">Norteamérica</option>
                <option value="suramerica">Suramérica</option>
                <option value="europa">Europa</option>
                <option value="africa_norte">África Norte</option>
                <option value="africa_sur">África Sur</option>
                <option value="asia_este">Asia Este</option>
                <option value="asia_oeste">Asia Oeste</option>
                <option value="oceania">Oceanía</option>
            </select>
        </div>
        <div class="form-group">
            <label for="i-sector">Sector Económico/Institucional:</label>
            <select id="i-sector" onchange="checkOther(this.value, 'i-otro-sector-container')" required>
                <option value="" disabled selected>Selecciona un sector</option>
                <option value="gobierno">Gobierno y municipalidades</option>
                <option value="transporte">Autoridades de transporte (tránsito, puertos, aviación)</option>
                <option value="educacion">Sector educativo (distritos escolares, administradores)</option>
                <option value="salud_cuidado">Cuidado de la salud (geriátricos, centros de salud)</option>
                <option value="parques_recreacion">Parques, recreación y deportes</option>
                <option value="turismo">Turismo</option>
                <option value="emergencias">Respuesta a emergencias (incendios, desastres)</option>
                <option value="meteorologia">Servicios meteorológicos</option>
                <option value="seguros">Seguros y evaluación de riesgos</option>
                <option value="ciencia_comunitaria">Ciencia ciudadana y participación pública</option>
                <option value="otro">Otro</option>
            </select>
        </div>
        <div id="i-otro-sector-container" class="form-group hidden">
            <label for="i-otro-sector">Por favor, especifica tu sector:</label>
            <input type="text" id="i-otro-sector">
        </div>
        <div class="form-group">
            <label for="i-actividad">Describe brevemente la actividad principal que realizan:</label>
            <textarea id="i-actividad" rows="4" required></textarea>
        </div>
        <button type="submit" class="btn secondary">Crear Cuenta Institucional</button>
    </form>
    
    <div id="welcome-message" class="hidden"></div>

</div>

<script>
    function showForm(formType) {
        document.getElementById('user-type-selection').classList.add('hidden');
        if (formType === 'personal') {
            document.getElementById('personal-form').classList.remove('hidden');
        } else if (formType === 'institucional') {
            document.getElementById('institucional-form').classList.remove('hidden');
        }
    }

    function checkOther(selectedValue, otherContainerId) {
        const otherContainer = document.getElementById(otherContainerId);
        if (selectedValue === 'otro') {
            otherContainer.classList.remove('hidden');
            otherContainer.querySelector('input').required = true;
        } else {
            otherContainer.classList.add('hidden');
            otherContainer.querySelector('input').required = false;
        }
    }

    function showVulnerableOptions(isVulnerable) {
        const vulnerableOptions = document.getElementById('vulnerable-options');
        if (isVulnerable) {
            vulnerableOptions.classList.remove('hidden');
            vulnerableOptions.querySelector('select').required = true;
        } else {
            vulnerableOptions.classList.add('hidden');
            vulnerableOptions.querySelector('select').required = false;
        }
    }
    
    function showWelcomeMessage(formId, message) {
        document.getElementById(formId).classList.add('hidden');
        const welcomeDiv = document.getElementById('welcome-message');
        welcomeDiv.textContent = message;
        welcomeDiv.classList.remove('hidden');
    }

    function createPersonalAccount() {
        const formData = new FormData();
        formData.append('p-nombre', document.getElementById('p-nombre').value);
        formData.append('p-email', document.getElementById('p-email').value);
        formData.append('p-password', document.getElementById('p-password').value);
        formData.append('p-edad', document.getElementById('p-edad').value);
        formData.append('p-region', document.getElementById('p-region').value);
        formData.append('p-telefono', document.getElementById('p-telefono').value);
        formData.append('p-sexo', document.getElementById('p-sexo').value);
        formData.append('p-oficio', document.getElementById('p-oficio').value);
        formData.append('p-otro-oficio', document.getElementById('p-otro-oficio').value);
        formData.append('vulnerable', document.querySelector('input[name="vulnerable"]:checked').value);
        formData.append('vulnerable-group', document.getElementById('vulnerable-group').value);
        
        fetch('/register_personal', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showWelcomeMessage('personal-form', data.message);
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al procesar el registro');
        });
        
        return false; // Previene el envío normal del formulario
    }
    
    function createInstitutionalAccount() {
        const formData = new FormData();
        formData.append('i-nombre', document.getElementById('i-nombre').value);
        formData.append('i-email', document.getElementById('i-email').value);
        formData.append('i-password', document.getElementById('i-password').value);
        formData.append('i-telefono', document.getElementById('i-telefono').value);
        formData.append('i-region', document.getElementById('i-region').value);
        formData.append('i-sector', document.getElementById('i-sector').value);
        formData.append('i-otro-sector', document.getElementById('i-otro-sector').value);
        formData.append('i-actividad', document.getElementById('i-actividad').value);
        
        fetch('/register_institutional', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showWelcomeMessage('institucional-form', data.message);
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al procesar el registro');
        });
        
        return false; // Previene el envío normal del formulario
    }
</script>

</body>
</html>